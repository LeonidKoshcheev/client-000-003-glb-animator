<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>GLB Viewer —Å –ê–Ω–∏–º–∞—Ü–∏–µ–π</title>
    <style>
      /* –°–±—Ä–æ—Å –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
      body {
        margin: 0;
        background: linear-gradient(to bottom, #000A25, #000A25);
      }
      /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã —É canvas */
      canvas {
        display: block;
      }
      
      /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
      .controls {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        display: flex;
        gap: 10px;
      }
      
      .control-btn {
        padding: 10px 15px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: 1px solid #4a90e2;
        border-radius: 5px;
        cursor: pointer;
        font-family: Arial, sans-serif;
        font-size: 14px;
      }
      
      .control-btn:hover {
        background: rgba(74, 144, 226, 0.3);
      }
      
      .control-btn.active {
        background: rgba(74, 144, 226, 0.7);
        border-color: #fff;
      }
      
      .status-indicator {
        padding: 10px 15px;
        background: rgba(0, 255, 0, 0.2);
        color: #00ff00;
        border: 1px solid #00ff00;
        border-radius: 5px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        margin-top: 10px;
        text-align: center;
      }
      
      .status-indicator.paused {
        background: rgba(255, 0, 0, 0.2);
        color: #ff0000;
        border-color: #ff0000;
      }
    </style>
  </head>
  <body>
    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="controls">
      <button class="control-btn" onclick="pauseAnimations()">‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏</button>
      <button class="control-btn" onclick="resumeAnimations()">‚ñ∂Ô∏è –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏</button>
      <button class="control-btn" onclick="testHeadRotation()">üéØ –¢–µ—Å—Ç –ø–æ–≤–æ—Ä–æ—Ç–∞ –≥–æ–ª–æ–≤—ã</button>
      <div class="status-indicator" id="statusIndicator">üîÑ –ê–Ω–∏–º–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç</div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Three.js –¥–ª—è 3D –≥—Ä–∞—Ñ–∏–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ OrbitControls –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π –º—ã—à—å—é -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ GLTFLoader –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ 3D –º–æ–¥–µ–ª–µ–π -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>

    <script>
      // ===== –°–û–ó–î–ê–ù–ò–ï –û–°–ù–û–í–ù–´–• –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¶–ï–ù–´ =====
      
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é 3D —Å—Ü–µ–Ω—É
      const scene = new THREE.Scene();
      // –£–±–∏—Ä–∞–µ–º —Ñ–æ–Ω —Å—Ü–µ–Ω—ã (–±—É–¥–µ—Ç –≤–∏–¥–µ–Ω –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏–∑ CSS)
      scene.background = null;

      // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—É—é –∫–∞–º–µ—Ä—É —Å —É–≥–ª–æ–º –æ–±–∑–æ—Ä–∞ 50¬∞, —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º —Å—Ç–æ—Ä–æ–Ω —ç–∫—Ä–∞–Ω–∞ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –≤–∏–¥–∏–º–æ—Å—Ç–∏ 1-1000
      const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã –≤ —Ç–æ—á–∫–µ (0, 0, 30)
      camera.position.set(0, 0, 20);




      
      // ===== –°–û–ó–î–ê–ù–ò–ï –†–ï–ù–î–ï–†–ï–†–ê =====
      
      // –°–æ–∑–¥–∞–µ–º WebGL —Ä–µ–Ω–¥–µ—Ä–µ—Ä —Å –∞–Ω—Ç–∏–∞–ª–∏–∞—Å–∏–Ω–≥–æ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
      const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞ —Ä–∞–≤–Ω—ã–º —Ä–∞–∑–º–µ—Ä—É –æ–∫–Ω–∞
      renderer.setSize(window.innerWidth, window.innerHeight);
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ sRGB –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
      renderer.outputEncoding = THREE.sRGBEncoding;
      // –í–∫–ª—é—á–∞–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
      renderer.physicallyCorrectLights = true;
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      renderer.toneMapping = THREE.NeutralToneMapping;
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–∫—Å–ø–æ–∑–∏—Ü–∏—é —Ç–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      renderer.toneMappingExposure = 1.7;
      // –î–æ–±–∞–≤–ª—è–µ–º canvas —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞ –≤ DOM
      document.body.appendChild(renderer.domElement);

      // ===== –ù–ê–°–¢–†–û–ô–ö–ê –û–°–í–ï–©–ï–ù–ò–Ø =====
      
      // –°–æ–∑–¥–∞–µ–º —Ä–∞—Å—Å–µ—è–Ω–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –≥–æ–ª—É–±–æ–≤–∞—Ç–æ–≥–æ –æ—Ç—Ç–µ–Ω–∫–∞ —Å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é 3
      const ambientLight = new THREE.AmbientLight(0xccddff, 3);
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—Ç –≤ —Å—Ü–µ–Ω—É
      scene.add(ambientLight);

      // ===== –ù–ê–°–¢–†–û–ô–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–ê–ú–ï–†–û–ô =====
      
      // –°–æ–∑–¥–∞–µ–º OrbitControls –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π –º—ã—à—å—é (–≤—Ä–∞—â–µ–Ω–∏–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ)
      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      // –í–∫–ª—é—á–∞–µ–º –ø–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
      controls.enableDamping = true;

      // ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ê–ù–ò–ú–ê–¶–ò–ò =====
      
      // –ú–∏–∫—Å–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
      let mixer = null;
      // –ß–∞—Å—ã –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏
      const clock = new THREE.Clock();
      // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –∞–Ω–∏–º–∞—Ü–∏–∏
      let actions = {};
      
      // ===== –ù–ê–°–¢–†–û–ô–ö–ò –ü–û–í–û–†–û–¢–ê –ì–û–õ–û–í–´ =====
      
      // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ–ª–æ–≤–æ–π
      let headBone = null;
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–æ—Ä–æ—Ç–∞ –≥–æ–ª–æ–≤—ã
      const maxHeadRotation = Math.PI / 3; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ (60 –≥—Ä–∞–¥—É—Å–æ–≤)
      
      // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π
      let animationsPaused = false;
      let originalAnimationWeights = {};

      // ===== –ù–ê–°–¢–†–û–ô–ö–ò –ê–ù–ò–ú–ê–¶–ò–ô =====
      
      // –û–±—ä–µ–∫—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
      const animationSettings = {
        'Morganie':  { additive: true,  weight: 1.0 },  // –ú–æ—Ä–≥–∞–Ω–∏–µ - –∞–¥–¥–∏—Ç–∏–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
        'Parenie':   { additive: false, weight: 1.0 },  // –ü–∞—Ä–µ–Ω–∏–µ - –æ–±—ã—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
        'Povorotes': { additive: true,  weight: 1.0 }   // –ü–æ–≤–æ—Ä–æ—Ç—ã - –∞–¥–¥–∏—Ç–∏–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
      };

      // ===== –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–ù–ò–ú–ê–¶–ò–Ø–ú–ò =====
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ –∏–º–µ–Ω–∏
      function playAnimation(name) {
        const action = actions[name];
        if (!action) {
          console.warn(`–ê–Ω–∏–º–∞—Ü–∏—è "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
          return;
        }
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∫ –Ω–∞—á–∞–ª—É –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
        action.reset().play();
      }
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –∞–Ω–∏–º–∞—Ü–∏–π
      function pauseAnimations() {
        if (animationsPaused) return;
        
        animationsPaused = true;
        originalAnimationWeights = {};
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –≤–µ—Å–∞ –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
        Object.keys(actions).forEach(name => {
          const action = actions[name];
          originalAnimationWeights[name] = action.getEffectiveWeight();
          action.setEffectiveWeight(0);
        });
        
        console.log('‚è∏Ô∏è –ê–Ω–∏–º–∞—Ü–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const statusIndicator = document.getElementById('statusIndicator');
        if (statusIndicator) {
          statusIndicator.textContent = '‚è∏Ô∏è –ê–Ω–∏–º–∞—Ü–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã';
          statusIndicator.className = 'status-indicator paused';
        }
      }
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∞–Ω–∏–º–∞—Ü–∏–π
      function resumeAnimations() {
        if (!animationsPaused) return;
        
        animationsPaused = false;
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∞–Ω–∏–º–∞—Ü–∏–π
        Object.keys(actions).forEach(name => {
          const action = actions[name];
          const originalWeight = originalAnimationWeights[name] || 1.0;
          action.setEffectiveWeight(originalWeight);
        });
        
        console.log('‚ñ∂Ô∏è –ê–Ω–∏–º–∞—Ü–∏–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω—ã');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const statusIndicator = document.getElementById('statusIndicator');
        if (statusIndicator) {
          statusIndicator.textContent = 'üîÑ –ê–Ω–∏–º–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç';
          statusIndicator.className = 'status-indicator';
        }
      }
      
      // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ù–û–ü–û–ö =====
      
      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫ HTML
      window.pauseAnimations = pauseAnimations;
      window.resumeAnimations = resumeAnimations;
      window.playAnimation = playAnimation;

      // ===== –ó–ê–ì–†–£–ó–ö–ê 3D –ú–û–î–ï–õ–ò =====
      
      // –°–æ–∑–¥–∞–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫ GLTF/GLB —Ñ–∞–π–ª–æ–≤
      const loader = new THREE.GLTFLoader();
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å –∏–∑ —Ñ–∞–π–ª–∞ model.glb
      loader.load('model.glb',
        // –§—É–Ω–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        (gltf) => {
          // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å –≤ 5 —Ä–∞–∑ –ø–æ –≤—Å–µ–º –æ—Å—è–º
          gltf.scene.scale.set(5, 5, 5);
          // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–µ–ª—å –≤ —Å—Ü–µ–Ω—É
          scene.add(gltf.scene);

          // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –æ–±—ä–µ–∫—Ç–∞–º –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ—Å—Ç–µ–π
          gltf.scene.traverse((obj) => {
            if (obj.isBone) {
              console.log('ü¶¥ –ö–æ—Å—Ç—å: "' + obj.name + '"'); // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ—Å—Ç–∏
              // –ò—â–µ–º –∫–æ—Å—Ç—å –≥–æ–ª–æ–≤—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–º–æ–∂–µ—Ç –±—ã—Ç—å "head", "neck", "skull" –∏ —Ç.–¥.)
              if (obj.name.toLowerCase().includes('head') || 
                  obj.name.toLowerCase().includes('neck') || 
                  obj.name.toLowerCase().includes('skull') ||
                  obj.name.toLowerCase().includes('bone') ||
                  obj.name.toLowerCase().includes('spine') ||
                  obj.name.toLowerCase().includes('chest')) {
                headBone = obj;
                console.log('üëÄ –ù–∞–π–¥–µ–Ω–∞ –∫–æ—Å—Ç—å –≥–æ–ª–æ–≤—ã:', obj.name);
              }
            }
          });
          
          // –ï—Å–ª–∏ –∫–æ—Å—Ç—å –≥–æ–ª–æ–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–≤—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –∫–æ—Å—Ç—å
          if (!headBone) {
            gltf.scene.traverse((obj) => {
              if (obj.isBone && !headBone) {
                headBone = obj;
                console.log('‚ö†Ô∏è –ö–æ—Å—Ç—å –≥–æ–ª–æ–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é:', obj.name);
              }
            });
          }

          // ===== –ù–ê–°–¢–†–û–ô–ö–ê –ê–ù–ò–ú–ê–¶–ò–ô =====
          
          // –°–æ–∑–¥–∞–µ–º –º–∏–∫—Å–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–π –¥–ª—è –¥–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
          mixer = new THREE.AnimationMixer(gltf.scene);

          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏–∑ –º–æ–¥–µ–ª–∏
          gltf.animations.forEach((clip) => {
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const settings = animationSettings[clip.name] || { additive: false, weight: 1.0 };
            
            // –ï—Å–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—è –∞–¥–¥–∏—Ç–∏–≤–Ω–∞—è, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ—ë
            let finalClip = settings.additive
              ? THREE.AnimationUtils.makeClipAdditive(clip)
              : clip;

            // –°–æ–∑–¥–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            const action = mixer.clipAction(finalClip);
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º —Å–º–µ—à–∏–≤–∞–Ω–∏—è (–∞–¥–¥–∏—Ç–∏–≤–Ω—ã–π –∏–ª–∏ –æ–±—ã—á–Ω—ã–π)
            action.blendMode = settings.additive
              ? THREE.AdditiveAnimationBlendMode
              : THREE.NormalAnimationBlendMode;
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Å –∞–Ω–∏–º–∞—Ü–∏–∏
            action.setEffectiveWeight(settings.weight);
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –≤ –æ–±—ä–µ–∫—Ç actions
            actions[clip.name] = action;
          });

          // –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π –≤ –∫–æ–Ω—Å–æ–ª—å
          console.log('üé¨ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∏–ø—ã:', Object.keys(actions));
          
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏
          playAnimation('Morganie');
          playAnimation('Parenie');
          playAnimation('Povorotes');
          

        },
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
        undefined,
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        (error) => {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏:', error);
        }
      );

      // ===== –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ –ê–ù–ò–ú–ê–¶–ò–ò =====
      
      // –§—É–Ω–∫—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
      function animate() {
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä –∞–Ω–∏–º–∞—Ü–∏–∏
        requestAnimationFrame(animate);
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º—è, –ø—Ä–æ—à–µ–¥—à–µ–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–∞–¥—Ä–∞
        const delta = clock.getDelta();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–∫—Å–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–π (–µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
        if (mixer) mixer.update(delta);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π
        controls.update();



        // –†–µ–Ω–¥–µ—Ä–∏–º —Å—Ü–µ–Ω—É
        renderer.render(scene, camera);
      }
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏
      animate();

      // ===== –û–ë–†–ê–ë–û–¢–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø –†–ê–ó–ú–ï–†–ê –û–ö–ù–ê =====
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
      window.addEventListener('resize', () => {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –∫–∞–º–µ—Ä—ã
        camera.aspect = window.innerWidth / window.innerHeight;
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—Ä–∏—Ü—É –ø—Ä–æ–µ–∫—Ü–∏–∏ –∫–∞–º–µ—Ä—ã
        camera.updateProjectionMatrix();
        // –ò–∑–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–õ–ê–í–ò–ê–¢–£–†–û–ô =====
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
      document.addEventListener('keydown', (e) => {
        if (e.key === '1') playAnimation('Morganie');    // –ö–ª–∞–≤–∏—à–∞ 1 - –º–æ—Ä–≥–∞–Ω–∏–µ
        if (e.key === '2') playAnimation('Parenie');     // –ö–ª–∞–≤–∏—à–∞ 2 - –ø–∞—Ä–µ–Ω–∏–µ
        if (e.key === '3') playAnimation('Povorotes');   // –ö–ª–∞–≤–∏—à–∞ 3 - –ø–æ–≤–æ—Ä–æ—Ç—ã
      });
      
      // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø =====
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –≥–æ–ª–æ–≤—ã
      function testHeadRotation() {
        if (!headBone) {
          console.log('‚ùå –ö–æ—Å—Ç—å –≥–æ–ª–æ–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
          return;
        }
        
        console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–≤–æ—Ä–æ—Ç –≥–æ–ª–æ–≤—ã...');
        pauseAnimations();
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≥–æ–ª–æ–≤—É –≤–ø—Ä–∞–≤–æ –¥–ª—è —Ç–µ—Å—Ç–∞
        if (headBone) {
          const targetRotationY = 0.5 * maxHeadRotation; // –ü–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ
          const targetRotationX = 0; // –ë–µ–∑ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–æ—Ä–æ—Ç–∞
          
          headBone.rotation.y = targetRotationY;
          headBone.rotation.x = targetRotationX;
          
          console.log('üéØ –ì–æ–ª–æ–≤–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∞ –≤ —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é:', {
            rotationY: targetRotationY,
            rotationX: targetRotationX,
            maxRotation: maxHeadRotation
          });
        }
      }
      
      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
      window.testHeadRotation = testHeadRotation;
    </script>
  </body>
</html>
