<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>GLB Viewer —Å –ê–Ω–∏–º–∞—Ü–∏–µ–π</title>
    <style>
      body { margin: 0; overflow: hidden; }
      canvas { display: block; }
    </style>
  </head>
  <body>
    <!-- Three.js –∏ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>


    <script>
      // 1) –°—Ü–µ–Ω–∞ –∏ —Ñ–æ–Ω
      const scene = new THREE.Scene();
      scene.environment = null;
      scene.background = new THREE.Color(0x111111);

      
      // 2) –ö–∞–º–µ—Ä–∞
      const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
      camera.position.set(0, 0, 4);

      // 3) –†–µ–Ω–¥–µ—Ä–µ—Ä
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // 4) –°–≤–µ—Ç
      const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
      scene.add(ambientLight);

      const dirLight = new THREE.DirectionalLight(0xffffff, 1);
      dirLight.position.set(0, -100, 4);
      scene.add(dirLight);

      // 5) –ö–æ–Ω—Ç—Ä–æ–ª—ã
      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // 6) –ê–Ω–∏–º–∞—Ü–∏—è: mixer –∏ —Ç–∞–π–º–µ—Ä
      let mixer = null;
      const clock = new THREE.Clock();

      // 7) –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
      const loader = new THREE.GLTFLoader();
      loader.load('2_Robot_Bone_.Action (1).glb',
        (gltf) => {
          scene.add(gltf.scene);

          if (gltf.animations && gltf.animations.length > 0) {
            mixer = new THREE.AnimationMixer(gltf.scene);

            // üëâ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–¥–¥–∏—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –º–∏–∫—Å–µ—Ä–∞
            mixer.blendMode = THREE.AdditiveAnimationBlendMode;

            gltf.animations.forEach((clip) => {
              // üëâ –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–ª–∏–ø –≤ –∞–¥–¥–∏—Ç–∏–≤–Ω—ã–π
              const additiveClip = THREE.AnimationUtils.makeClipAdditive(clip);

              // üëâ –°–æ–∑–¥–∞—ë–º –¥–µ–π—Å—Ç–≤–∏–µ –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
              const action = mixer.clipAction(additiveClip);
              action.blendMode = THREE.AdditiveAnimationBlendMode;
              action.setEffectiveWeight(1.0);
              action.play();
            });

            console.log('Available clips:', gltf.animations.map(c => c.name));
          }
        },
        undefined,
        (error) => {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏:', error);
        }
      );


      // 8) –¶–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏
      function animate() {
        requestAnimationFrame(animate);

        const delta = clock.getDelta();
        if (mixer) mixer.update(delta);

        controls.update();
        renderer.render(scene, camera);
      }
      animate();

      // 9) –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
